# 07 - ç”µæœºæ§åˆ¶å¿«é€Ÿå…¥é—¨

> **éš¾åº¦**: â­â­â­â˜†â˜†  
> **é¢„è®¡æ—¶é—´**: 60åˆ†é’Ÿ  
> **å‰ç½®è¦æ±‚**: å®ŒæˆåŒä¸²å£é€šä¿¡é…ç½®ï¼Œäº†è§£RS485åŸºç¡€

---

## ğŸ“‹ ç›®å½•

1. [ç¡¬ä»¶å‡†å¤‡](#1-ç¡¬ä»¶å‡†å¤‡)
2. [Emm_V5åè®®è¯¦è§£](#2-emm_v5åè®®è¯¦è§£)
3. [APIå‡½æ•°åº“ä½¿ç”¨](#3-apiå‡½æ•°åº“ä½¿ç”¨)
4. [å®æˆ˜ç¤ºä¾‹ä»£ç ](#4-å®æˆ˜ç¤ºä¾‹ä»£ç )
5. [å¸¸è§é—®é¢˜ä¸è°ƒè¯•](#5-å¸¸è§é—®é¢˜ä¸è°ƒè¯•)

---

## 1. ç¡¬ä»¶å‡†å¤‡

### 1.1 å¼ å¤§å¤´Yç³»åˆ—ç”µæœºå‚æ•°

**å‹å·**: Y57-42-32 / Y57-42-51 ï¼ˆæ ¹æ®å®é™…é€‰å‹ï¼‰

**å…³é”®å‚æ•°**ï¼š

| å‚æ•° | è§„æ ¼ |
|------|------|
| æ­¥è¿›è§’ | 1.8Â° (200æ­¥/åœˆ) |
| ç»†åˆ†è®¾ç½® | 16ç»†åˆ†ï¼ˆé»˜è®¤ï¼‰ |
| å®é™…åˆ†è¾¨ç‡ | 3200è„‰å†²/åœˆ |
| é¢å®šç”µå‹ | DC 24V |
| é¢å®šç”µæµ | 1.5A |
| ä¿æŒè½¬çŸ© | 0.4 NÂ·m |
| é€šä¿¡æ¥å£ | RS485 (A/Bå·®åˆ†) |
| é»˜è®¤åœ°å€ | 0x01 |
| é»˜è®¤æ³¢ç‰¹ç‡ | 115200 bps |

**ç»†åˆ†è®¡ç®—**ï¼š
```
200æ­¥/åœˆ Ã— 16ç»†åˆ† = 3200è„‰å†²/åœˆ
åŠåœˆ = 1600è„‰å†²
1/4åœˆ = 800è„‰å†²
```

---

### 1.2 ç¡¬ä»¶æ¥çº¿

#### ç”µæºæ¥çº¿

```
24Vç”µæºæ­£æ â”€â”€â”€â†’ ç”µæœºé©±åŠ¨å™¨ V+
24Vç”µæºè´Ÿæ â”€â”€â”€â†’ ç”µæœºé©±åŠ¨å™¨ GND
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âš ï¸ **ä¸¥ç¦åæ¥**ï¼Œä¼šçƒ§æ¯é©±åŠ¨å™¨
- å»ºè®®ä½¿ç”¨24V/2Aä»¥ä¸Šå¼€å…³ç”µæº
- ç”µæºçº¿å»ºè®®ä½¿ç”¨1.0mmÂ²ä»¥ä¸Šçº¿å¾„

---

#### RS485æ¥çº¿ï¼ˆé‡è¦ï¼‰

```
STM32 USART2 â†’ ATK-MB024 â†’ ç”µæœºé©±åŠ¨å™¨
PA2 (TX)     â†’ TTL_TX     â†’ (ä¸è¿æ¥)
PA3 (RX)     â†’ TTL_RX     â†’ (ä¸è¿æ¥)
                 â†“
               RS485_A  â”€â”€â†’ ç”µæœºé©±åŠ¨å™¨ A
               RS485_B  â”€â”€â†’ ç”µæœºé©±åŠ¨å™¨ B
```

**å…³é”®è¦ç‚¹**ï¼š
1. **Aå¯¹Aï¼ŒBå¯¹B**ï¼ˆä¸è¦äº¤å‰è¿æ¥ï¼‰
2. **å•æœºé€šä¿¡ä¸éœ€è¦ç»ˆç«¯ç”µé˜»**
3. **å¤šæœºé€šä¿¡ï¼ˆ2å°ä»¥ä¸Šï¼‰éœ€åœ¨æ€»çº¿ä¸¤ç«¯å„å¹¶è”120Î©ç»ˆç«¯ç”µé˜»**

**éªŒè¯æ–¹æ³•**ï¼š

```c
// å‘é€æµ‹è¯•å­—ç¬¦'U' (0x55 = 01010101b)
HAL_UART_Transmit(&g_uart2_handle, (uint8_t*)"U", 1, 100);
// ç”¨ç¤ºæ³¢å™¨è§‚å¯ŸRS485_Aå’ŒRS485_Båº”å‘ˆç°å·®åˆ†æ³¢å½¢
```

---

### 1.3 ç”µæœºåœ°å€è®¾ç½®

**æŸ¥çœ‹å½“å‰åœ°å€**ï¼ˆé€šè¿‡å¼ å¤§å¤´ä¸Šä½æœºï¼‰ï¼š
1. è¿æ¥USBè½¬RS485æ¨¡å—åˆ°ç”µè„‘
2. æ‰“å¼€ `é—­ç¯æ­¥è¿›ç”µæœºè°ƒè¯•åŠ©æ‰‹.exe`
3. é€‰æ‹©COMå£ï¼Œæ³¢ç‰¹ç‡115200
4. ç‚¹å‡»"è¯»å–å‚æ•°" â†’ æ˜¾ç¤ºå½“å‰åœ°å€

**ä¿®æ”¹åœ°å€**ï¼ˆç”¨äºå¤šæœºæ§åˆ¶ï¼‰ï¼š

```c
// æ–¹æ³•1ï¼šé€šè¿‡ä¸Šä½æœº
// å‚æ•°è®¾ç½® â†’ ç”µæœºåœ°å€ â†’ è¾“å…¥æ–°åœ°å€(1-255) â†’ ä¿å­˜å‚æ•°

// æ–¹æ³•2ï¼šé€šè¿‡ä»£ç ï¼ˆéœ€å…ˆä½¿èƒ½ç”µæœºï¼‰
Emm_V5_Save_Param(0x01, 0x11, 0x02);  // å°†åœ°å€0x01æ”¹ä¸º0x02
HAL_Delay(100);
Emm_V5_Read_Sys_Params(0x02);         // ç”¨æ–°åœ°å€è¯»å–éªŒè¯
```

**åœ°å€åˆ†é…å»ºè®®**ï¼ˆå¤šæœºç³»ç»Ÿï¼‰ï¼š

| ç”µæœº | åœ°å€ | ç”¨é€” |
|------|------|------|
| Motor 1 | 0x01 | Xè½´ |
| Motor 2 | 0x02 | Yè½´ |
| Motor 3 | 0x03 | Zè½´ |
| Motor 4 | 0x04 | æ—‹è½¬è½´ |
| ... | ... | ... |
| Broadcast | 0x00 | åŒæ­¥å‘½ä»¤å¹¿æ’­åœ°å€ |

---

## 2. Emm_V5åè®®è¯¦è§£

### 2.1 åè®®å¸§æ ¼å¼

#### æ§åˆ¶å¸§ï¼ˆä¸»æœºâ†’ç”µæœºï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚åœ°å€ â”‚åŠŸèƒ½ç â”‚é€Ÿåº¦ä½â”‚é€Ÿåº¦é«˜â”‚åŠ é€Ÿåº¦â”‚è„‰å†²ä½â”‚è„‰å†²ä¸­â”‚è„‰å†²é«˜â”‚
â”‚Addr â”‚Cmd  â”‚SpeedLâ”‚SpeedHâ”‚Acc  â”‚PulL â”‚PulM â”‚PulH â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
 1å­—èŠ‚ 1å­—èŠ‚  1å­—èŠ‚  1å­—èŠ‚  1å­—èŠ‚  1å­—èŠ‚  1å­—èŠ‚  1å­—èŠ‚
```

**ç¤ºä¾‹**ï¼ˆç”µæœºåœ°å€0x01ï¼Œé¡ºæ—¶é’ˆ300RPMï¼ŒåŠ é€Ÿåº¦10ï¼Œè½¬åŠ¨3200è„‰å†²ï¼‰ï¼š
```
å‘é€: 01 FD 2C 01 0A 00 0C 80
è§£æ:
  åœ°å€:   01
  åŠŸèƒ½ç : FD (ä½ç½®æ¨¡å¼)
  é€Ÿåº¦:   012C (300 RPM)
  åŠ é€Ÿåº¦: 0A (10)
  è„‰å†²æ•°: 000C80 (3200è„‰å†² = 1åœˆ)
```

---

#### å“åº”å¸§ï¼ˆç”µæœºâ†’ä¸»æœºï¼‰

**æ ¼å¼1ï¼šç®€å•ç¡®è®¤ï¼ˆ4å­—èŠ‚ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚åœ°å€ â”‚åŠŸèƒ½ç â”‚çŠ¶æ€ â”‚æ ¡éªŒ â”‚
â”‚Addr â”‚Cmd  â”‚Statusâ”‚6B   â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
 1å­—èŠ‚ 1å­—èŠ‚  1å­—èŠ‚  1å­—èŠ‚
```

**ç¤ºä¾‹**ï¼š
```
æ¥æ”¶: 01 FD 02 6B
è§£æ:
  åœ°å€:   01
  åŠŸèƒ½ç : FD (ä½ç½®æ§åˆ¶)
  çŠ¶æ€:   02 (å‘½ä»¤æ‰§è¡Œä¸­)
  æ ¡éªŒ:   6B (å›ºå®šå€¼)
```

**çŠ¶æ€ç å«ä¹‰**ï¼š

| çŠ¶æ€ç  | å«ä¹‰ | è¯´æ˜ |
|--------|------|------|
| 0x00 | å¤±è´¥ | å‚æ•°é”™è¯¯æˆ–ç”µæœºæœªä½¿èƒ½ |
| 0x01 | æˆåŠŸ | ç«‹å³æ¨¡å¼å‘½ä»¤æ‰§è¡Œå®Œæˆ |
| 0x02 | æ‰§è¡Œä¸­ | ç”µæœºæ­£åœ¨è¿è¡Œ |

---

**æ ¼å¼2ï¼šå‚æ•°è¯»å–ï¼ˆå¯å˜é•¿åº¦ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚åœ°å€ â”‚åŠŸèƒ½ç â”‚æ•°æ®... â”‚æ ¡éªŒ â”‚
â”‚Addr â”‚Cmd  â”‚Data   â”‚6B   â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

**ç¤ºä¾‹**ï¼ˆè¯»å–ç³»ç»Ÿå‚æ•°ï¼‰ï¼š
```
å‘é€: 01 42 6B
æ¥æ”¶: 01 42 11 01 00 C8 02 ... 6B
è§£æ:
  åœ°å€:   01
  åŠŸèƒ½ç : 42 (è¯»å–å‚æ•°)
  å‚æ•°1:  11 (ç”µæœºåœ°å€å¯„å­˜å™¨)
  å‚æ•°2:  01 (å½“å‰åœ°å€=1)
  å‚æ•°3:  00 C8 (ç»†åˆ†=200Ã—16=3200)
  ...
```

---

### 2.2 æ ¸å¿ƒåŠŸèƒ½ç 

| åŠŸèƒ½ç  | åŠŸèƒ½åç§° | è¯´æ˜ |
|--------|----------|------|
| 0xF3 | ä½¿èƒ½/å¤±èƒ½ | å¿…é¡»å…ˆä½¿èƒ½æ‰èƒ½æ§åˆ¶ |
| 0xF6 | é€Ÿåº¦æ¨¡å¼ | è¿ç»­æ—‹è½¬ï¼Œä¸æŒ‡å®šä½ç½® |
| 0xFD | ä½ç½®æ¨¡å¼ | ç›¸å¯¹/ç»å¯¹ä½ç½®æ§åˆ¶ |
| 0xFE | æ€¥åœ | ç«‹å³åœæ­¢è¿åŠ¨ |
| 0xFF | ç´§æ€¥åœæ­¢å¹¶å¤±èƒ½ | æ€¥åœ+æ–­ç”µ |
| 0x9A | å›é›¶ | è§¦å‘å›é›¶åŠŸèƒ½ |
| 0x91 | åŒæ­¥è¿åŠ¨ | å¤šæœºåŒæ­¥å¯åŠ¨ |
| 0x31 | è®¾ç½®é›¶ç‚¹ | å°†å½“å‰ä½ç½®è®¾ä¸ºé›¶ç‚¹ |
| 0x3A | æ¸…é™¤é”™è¯¯ | æ¸…é™¤æ•…éšœæ ‡å¿— |
| 0x42 | è¯»å–å‚æ•° | æŸ¥è¯¢ç³»ç»Ÿå‚æ•° |
| 0x48 | ä¿å­˜å‚æ•° | ä¿®æ”¹å¹¶ä¿å­˜åˆ°Flash |

---

### 2.3 FIFOæ¥æ”¶æœºåˆ¶

**ä¸ºä½•éœ€è¦FIFOï¼Ÿ**

RS485é€šä¿¡ä¸­ï¼Œç”µæœºå“åº”å¸§åˆ°è¾¾æ—¶é—´ä¸å›ºå®šï¼ˆ1-50msï¼‰ï¼Œç›´æ¥åœ¨ä¸­æ–­ä¸­å¤„ç†ä¼šå¯¼è‡´ï¼š
- ä¸»ç¨‹åºè¢«é•¿æ—¶é—´é˜»å¡
- å¤šå¸§æ•°æ®ä¸¢å¤±ï¼ˆä¸­æ–­ä¸­æ— æ³•å¤„ç†æ–°æ¥æ”¶ï¼‰
- ä»£ç å¤æ‚åº¦é«˜

**è§£å†³æ–¹æ¡ˆï¼šåŒç¼“å†²FIFO**

```
  USART2 RXNEä¸­æ–­       IDLEä¸­æ–­           ä¸»å¾ªç¯
       â†“                   â†“                 â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚å­—èŠ‚å…¥é˜Ÿ â”‚ â”€â”€â”€â†’  â”‚å¸§æ ‡è®°å®Œæˆâ”‚ â”€â”€â”€â†’ â”‚å‡ºé˜Ÿè§£æ  â”‚
  â”‚emm_fifo â”‚       â”‚g_emm_frameâ”‚      â”‚å¤„ç†å“åº”  â”‚
  â”‚_enqueue â”‚       â”‚_complete=1â”‚      â”‚          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ç¯å½¢é˜Ÿåˆ—           æ ‡å¿—ä½            è½®è¯¢å¤„ç†
    256å­—èŠ‚            ISRè®¾ç½®          åº”ç”¨å±‚
```

---

**å®ç°ä»£ç **ï¼ˆ`emm_fifo.c`ï¼‰ï¼š

```c
// ç¯å½¢FIFOç»“æ„
typedef struct {
    uint8_t buffer[256];
    uint8_t head;  // å†™æŒ‡é’ˆ
    uint8_t tail;  // è¯»æŒ‡é’ˆ
} emm_fifo_t;

static emm_fifo_t g_emm_fifo;

// å…¥é˜Ÿï¼ˆRXNEä¸­æ–­è°ƒç”¨ï¼‰
void emm_fifo_enqueue(uint8_t data)
{
    uint8_t next = (g_emm_fifo.head + 1) % 256;
    if (next != g_emm_fifo.tail) {  // æœªæ»¡
        g_emm_fifo.buffer[g_emm_fifo.head] = data;
        g_emm_fifo.head = next;
    }
}

// å‡ºé˜Ÿï¼ˆä¸»å¾ªç¯è°ƒç”¨ï¼‰
uint8_t emm_fifo_dequeue(uint8_t *data)
{
    if (g_emm_fifo.head == g_emm_fifo.tail)  // ç©º
        return 0;
    
    *data = g_emm_fifo.buffer[g_emm_fifo.tail];
    g_emm_fifo.tail = (g_emm_fifo.tail + 1) % 256;
    return 1;
}
```

**ä¸­æ–­å¤„ç†**ï¼ˆ`usart.c`ï¼‰ï¼š

```c
void USART2_IRQHandler(void)
{
    if (__HAL_UART_GET_FLAG(&g_uart2_handle, UART_FLAG_RXNE))
    {
        uint8_t data = USART2->DR;
        emm_fifo_enqueue(data);  // å­—èŠ‚çº§å…¥é˜Ÿ
    }
    
    if (__HAL_UART_GET_FLAG(&g_uart2_handle, UART_FLAG_IDLE))
    {
        __HAL_UART_CLEAR_IDLEFLAG(&g_uart2_handle);
        usart2_idle_callback();  // å¸§çº§å¤„ç†
    }
}

void usart2_idle_callback(void)
{
    g_emm_rx_count = 0;
    uint8_t data;
    
    // ä»FIFOå‡ºé˜Ÿåˆ°å¸§ç¼“å†²åŒº
    while (emm_fifo_dequeue(&data) && g_emm_rx_count < EMM_RX_BUF_SIZE)
    {
        g_emm_rx_cmd[g_emm_rx_count++] = data;
    }
    
    if (g_emm_rx_count >= 4)  // æœ€å°æœ‰æ•ˆå¸§4å­—èŠ‚
        g_emm_frame_complete = 1;  // é€šçŸ¥ä¸»å¾ªç¯
}
```

---

## 3. APIå‡½æ•°åº“ä½¿ç”¨

### 3.1 åˆå§‹åŒ–ä¸ä½¿èƒ½

#### 3.1.1 ä½¿èƒ½ç”µæœºï¼ˆå¿…é¡»é¦–å…ˆè°ƒç”¨ï¼‰

```c
/**
 * @brief  æ§åˆ¶ç”µæœºä½¿èƒ½/å¤±èƒ½
 * @param  addr: ç”µæœºåœ°å€ (1-255, 0=å¹¿æ’­)
 * @param  state: true=ä½¿èƒ½, false=å¤±èƒ½
 * @param  snF: åŒæ­¥æ ‡å¿— (false=ç«‹å³æ‰§è¡Œ, true=ç­‰å¾…åŒæ­¥å‘½ä»¤)
 * @retval æ— 
 */
void Emm_V5_En_Control(uint8_t addr, bool state, bool snF);
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```c
// åˆå§‹åŒ–åå¿…é¡»å…ˆä½¿èƒ½ç”µæœº
HAL_Delay(100);  // ç­‰å¾…ç”µæœºä¸Šç”µç¨³å®š
Emm_V5_En_Control(0x01, true, false);  // ä½¿èƒ½åœ°å€1ç”µæœº
HAL_Delay(50);   // ç­‰å¾…ä½¿èƒ½å®Œæˆ

// åœæ­¢ä½¿ç”¨æ—¶å¤±èƒ½ï¼ˆçœç”µ+ä¿æŠ¤ï¼‰
Emm_V5_En_Control(0x01, false, false);
```

---

### 3.2 ä½ç½®æ§åˆ¶ï¼ˆæœ€å¸¸ç”¨ï¼‰

#### 3.2.1 ç›¸å¯¹ä½ç½®è¿åŠ¨

```c
/**
 * @brief  ä½ç½®æ¨¡å¼æ§åˆ¶
 * @param  addr: ç”µæœºåœ°å€
 * @param  dir: æ–¹å‘ (0=CWé¡ºæ—¶é’ˆ, 1=CCWé€†æ—¶é’ˆ)
 * @param  speed: é€Ÿåº¦ 0-5000 RPM
 * @param  acc: åŠ é€Ÿåº¦ 0-255 (0=ç›´æ¥å¯åŠ¨)
 * @param  clk: è„‰å†²æ•° (16ç»†åˆ†: 3200=1åœˆ)
 * @param  raF: ç›¸å¯¹/ç»å¯¹ (false=ç›¸å¯¹, true=ç»å¯¹)
 * @param  snF: åŒæ­¥æ ‡å¿—
 * @retval æ— 
 */
void Emm_V5_Pos_Control(uint8_t addr, uint8_t dir, uint16_t speed,
                        uint8_t acc, uint32_t clk, bool raF, bool snF);
```

**ç¤ºä¾‹1ï¼šåŸºç¡€æ—‹è½¬**

```c
// ç”µæœº1ï¼Œé¡ºæ—¶é’ˆï¼Œ300RPMï¼ŒåŠ é€Ÿåº¦10ï¼Œè½¬1åœˆï¼ˆ3200è„‰å†²ï¼‰
Emm_V5_Pos_Control(0x01, 0, 300, 10, 3200, false, false);
HAL_Delay(5000);  // ç­‰å¾…è¿åŠ¨å®Œæˆï¼ˆå®é™…å¯æŸ¥è¯¢çŠ¶æ€ï¼‰

// é€†æ—¶é’ˆè½¬åŠåœˆ
Emm_V5_Pos_Control(0x01, 1, 300, 10, 1600, false, false);
```

**ç¤ºä¾‹2ï¼šå‚æ•°å¯¹æ¯”**

```c
// ä½é€Ÿé«˜ç²¾åº¦ï¼ˆé€‚åˆå®šä½ï¼‰
Emm_V5_Pos_Control(0x01, 0, 50, 5, 800, false, false);   // 50RPM, 1/4åœˆ

// é«˜é€Ÿè¿åŠ¨ï¼ˆé€‚åˆå¿«é€Ÿç§»åŠ¨ï¼‰
Emm_V5_Pos_Control(0x01, 0, 1000, 20, 6400, false, false);  // 1000RPM, 2åœˆ

// æä½åŠ é€Ÿåº¦ï¼ˆé€‚åˆé‡è½½ï¼‰
Emm_V5_Pos_Control(0x01, 0, 300, 1, 3200, false, false);  // ç¼“æ…¢åŠ é€Ÿ
```

**åŠ é€Ÿåº¦å‚æ•°è¯´æ˜**ï¼š
- `0`: æ— åŠ é€Ÿåº¦ï¼Œç›´æ¥å¯åŠ¨ï¼ˆå¯èƒ½ä¸¢æ­¥ï¼‰
- `1-10`: ç¼“æ…¢åŠ é€Ÿï¼ˆé‡è½½/ç²¾å¯†å®šä½ï¼‰
- `11-20`: ä¸­ç­‰åŠ é€Ÿï¼ˆå¸¸è§„ä½¿ç”¨ï¼‰
- `21-255`: å¿«é€ŸåŠ é€Ÿï¼ˆè½»è½½/å¿«é€Ÿå“åº”ï¼‰

---

#### 3.2.2 ç»å¯¹ä½ç½®è¿åŠ¨

```c
// å›åˆ°ç»å¯¹é›¶ç‚¹ï¼ˆä¸Šç”µæˆ–å›é›¶åå»ºç«‹çš„åŸç‚¹ï¼‰
Emm_V5_Pos_Control(0x01, 0, 300, 10, 0, true, false);

// ç§»åŠ¨åˆ°ç»å¯¹ä½ç½®3200ï¼ˆ1åœˆä½ç½®ï¼‰
Emm_V5_Pos_Control(0x01, 0, 300, 10, 3200, true, false);

// ç§»åŠ¨åˆ°ç»å¯¹ä½ç½®-1600ï¼ˆåå‘åŠåœˆä½ç½®ï¼‰
// æ³¨æ„ï¼šè´Ÿæ•°éœ€è¦è®¾ç½®dir=1å¹¶ä½¿ç”¨ç»å¯¹å€¼
Emm_V5_Pos_Control(0x01, 1, 300, 10, 1600, true, false);
```

---

### 3.3 é€Ÿåº¦æ§åˆ¶

#### 3.3.1 è¿ç»­æ—‹è½¬

```c
/**
 * @brief  é€Ÿåº¦æ¨¡å¼æ§åˆ¶
 * @param  addr: ç”µæœºåœ°å€
 * @param  dir: æ–¹å‘ (0=CW, 1=CCW)
 * @param  speed: é€Ÿåº¦ 0-5000 RPM
 * @param  acc: åŠ é€Ÿåº¦ 0-255
 * @param  snF: åŒæ­¥æ ‡å¿—
 * @retval æ— 
 */
void Emm_V5_Vel_Control(uint8_t addr, uint8_t dir, uint16_t speed,
                        uint8_t acc, bool snF);
```

**ç¤ºä¾‹**ï¼š

```c
// å¯åŠ¨è¿ç»­æ—‹è½¬
Emm_V5_Vel_Control(0x01, 0, 500, 20, false);  // 500RPMé¡ºæ—¶é’ˆ
HAL_Delay(10000);  // è¿è¡Œ10ç§’

// æ€¥åœ
Emm_V5_Stop_Now(0x01, false);

// æ”¹å˜æ–¹å‘
Emm_V5_Vel_Control(0x01, 1, 300, 15, false);  // 300RPMé€†æ—¶é’ˆ
```

---

#### 3.3.2 åœæ­¢æ§åˆ¶

```c
// æ€¥åœï¼ˆç«‹å³åœæ­¢ï¼Œå¯èƒ½æœ‰æƒ¯æ€§ï¼‰
Emm_V5_Stop_Now(0x01, false);

// ç´§æ€¥åœæ­¢+å¤±èƒ½ï¼ˆå®Œå…¨æ–­ç”µï¼‰
uint8_t cmd[] = {0x01, 0xFF, 0x6B};
HAL_UART_Transmit(&g_uart2_handle, cmd, 3, 100);
```

---

### 3.4 å¤šæœºåŒæ­¥æ§åˆ¶

**åº”ç”¨åœºæ™¯**ï¼šä¸¤è½´/ä¸‰è½´è”åŠ¨ã€é¾™é—¨ç»“æ„åŒæ­¥

**æ­¥éª¤**ï¼š
1. åˆ†åˆ«å‘é€**å¸¦åŒæ­¥æ ‡å¿—**çš„æ§åˆ¶å‘½ä»¤ï¼ˆ`snF=true`ï¼‰
2. å‘é€**åŒæ­¥è¿åŠ¨å‘½ä»¤**ï¼ˆå¹¿æ’­åœ°å€0x00ï¼‰
3. æ‰€æœ‰ç”µæœºåŒæ—¶å¯åŠ¨

**ç¤ºä¾‹ä»£ç **ï¼š

```c
// åœºæ™¯ï¼šXè½´å’ŒYè½´åŒæ—¶è¿åŠ¨ï¼ˆç›´çº¿æ’è¡¥ï¼‰
void move_line_xy(int32_t x_pulse, int32_t y_pulse, uint16_t speed)
{
    // æ­¥éª¤1ï¼šå‘é€Xè½´åŒæ­¥å‘½ä»¤
    uint8_t x_dir = (x_pulse >= 0) ? 0 : 1;
    Emm_V5_Pos_Control(0x01, x_dir, speed, 10, abs(x_pulse), false, true);
    HAL_Delay(10);
    
    // æ­¥éª¤2ï¼šå‘é€Yè½´åŒæ­¥å‘½ä»¤
    uint8_t y_dir = (y_pulse >= 0) ? 0 : 1;
    Emm_V5_Pos_Control(0x02, y_dir, speed, 10, abs(y_pulse), false, true);
    HAL_Delay(10);
    
    // æ­¥éª¤3ï¼šè§¦å‘åŒæ­¥å¯åŠ¨
    Emm_V5_Synchronous_motion(0x00);  // å¹¿æ’­åœ°å€
    
    // æ­¥éª¤4ï¼šç­‰å¾…è¿åŠ¨å®Œæˆï¼ˆè½®è¯¢æˆ–å»¶æ—¶ï¼‰
    uint32_t max_time = (abs(x_pulse) > abs(y_pulse) ? abs(x_pulse) : abs(y_pulse));
    max_time = max_time * 60 / (speed * 3200) * 1000 + 1000;  // è®¡ç®—æ—¶é—´ms
    HAL_Delay(max_time);
}

// è°ƒç”¨ç¤ºä¾‹
move_line_xy(6400, 3200, 300);  // Xè½´2åœˆ, Yè½´1åœˆ, åŒæ—¶å®Œæˆ
```

---

### 3.5 å›é›¶åŠŸèƒ½

#### 3.5.1 å›é›¶æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| æ¨¡å¼0 | å•åœˆå°±è¿‘å›é›¶ | æ— é™ä½å¼€å…³ï¼Œå·²çŸ¥é›¶ç‚¹åœ¨1åœˆå†… |
| æ¨¡å¼1 | å•åœˆæ–¹å‘å›é›¶ | æ— é™ä½å¼€å…³ï¼ŒæŒ‡å®šæ–¹å‘å¯»æ‰¾é›¶ç‚¹ |
| æ¨¡å¼2 | å¤šåœˆæ— é™ä½å›é›¶ | æ— é™ä½å¼€å…³ï¼Œå¤±é€Ÿæ£€æµ‹é›¶ç‚¹ |
| æ¨¡å¼3 | å¤šåœˆé™ä½å¼€å…³å›é›¶ | æœ‰ç¡¬ä»¶é™ä½å¼€å…³ |

---

#### 3.5.2 æ¨¡å¼0ï¼šå•åœˆå°±è¿‘å›é›¶

```c
/**
 * @brief  è§¦å‘å›é›¶ï¼ˆæ¨¡å¼0ï¼‰
 * @param  addr: ç”µæœºåœ°å€
 * @param  dir: æœç´¢æ–¹å‘ (0=CW, 1=CCW)
 * @param  snF: åŒæ­¥æ ‡å¿—
 * @retval æ— 
 */
void Emm_V5_Origin_Trigger_Return(uint8_t addr, uint8_t dir, bool snF);
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```c
// åœºæ™¯ï¼šæœºæ¢°è‡‚å…³èŠ‚å›é›¶
printf("å¼€å§‹å›é›¶...\r\n");
Emm_V5_Origin_Trigger_Return(0x01, 0, false);  // é¡ºæ—¶é’ˆæœç´¢é›¶ç‚¹
HAL_Delay(5000);  // ç­‰å¾…å›é›¶å®Œæˆï¼ˆå®é™…åº”æŸ¥è¯¢çŠ¶æ€ï¼‰

// éªŒè¯é›¶ç‚¹ï¼šè¯»å–å½“å‰ä½ç½®
Emm_V5_Read_Sys_Params(0x01);
HAL_Delay(100);
// è§£æå“åº”å¸§ä¸­çš„ä½ç½®å¯„å­˜å™¨ï¼Œåº”ä¸º0
```

---

#### 3.5.3 æ¨¡å¼3ï¼šé™ä½å¼€å…³å›é›¶

```c
/**
 * @brief  è§¦å‘é™ä½å¼€å…³å›é›¶
 * @param  addr: ç”µæœºåœ°å€
 * @param  dir: æœç´¢æ–¹å‘
 * @param  speed: å›é›¶é€Ÿåº¦ RPM
 * @param  snF: åŒæ­¥æ ‡å¿—
 * @retval æ— 
 */
void Emm_V5_Origin_Modify_Params_3(uint8_t addr, uint8_t dir,
                                   uint16_t speed, bool snF);
```

**ç¡¬ä»¶è¿æ¥**ï¼š
```
é™ä½å¼€å…³ â”€â”€â†’ ç”µæœºé©±åŠ¨å™¨ PL- (NPNå¸¸å¼€)
         â”€â”€â†’ é©±åŠ¨å™¨ 24V (COM)
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```c
// åœºæ™¯ï¼š3Dæ‰“å°æœºZè½´å›é›¶
void z_axis_home(void)
{
    printf("Zè½´å¼€å§‹å›é›¶...\r\n");
    
    // è®¾ç½®å›é›¶é€Ÿåº¦100RPMï¼Œé€†æ—¶é’ˆï¼ˆå‘ä¸‹ï¼‰æœç´¢
    Emm_V5_Origin_Modify_Params_3(0x03, 1, 100, false);
    
    // ç­‰å¾…é™ä½å¼€å…³è§¦å‘ï¼ˆå®é™…åº”æŸ¥è¯¢çŠ¶æ€æˆ–GPIOä¸­æ–­ï¼‰
    HAL_Delay(10000);
    
    printf("Zè½´å›é›¶å®Œæˆ\r\n");
    
    // æŠ¬èµ·5mmï¼ˆå‡è®¾ä¸æ å¯¼ç¨‹2mmï¼‰
    uint32_t lift_pulse = 5.0 / 2.0 * 3200;  // 8000è„‰å†²
    Emm_V5_Pos_Control(0x03, 0, 200, 10, lift_pulse, false, false);
}
```

---

### 3.6 çŠ¶æ€æŸ¥è¯¢

#### 3.6.1 è¯»å–ç³»ç»Ÿå‚æ•°

```c
/**
 * @brief  è¯»å–ç”µæœºç³»ç»Ÿå‚æ•°
 * @param  addr: ç”µæœºåœ°å€
 * @retval æ— ï¼ˆé€šè¿‡IDLEä¸­æ–­æ¥æ”¶å“åº”ï¼‰
 */
void Emm_V5_Read_Sys_Params(uint8_t addr);
```

**å“åº”å¸§è§£æ**ï¼š

```c
// ä¸»å¾ªç¯ä¸­å¤„ç†
if (g_emm_frame_complete)
{
    g_emm_frame_complete = 0;
    
    if (g_emm_rx_count >= 10 && g_emm_rx_cmd[0] == 0x01 && g_emm_rx_cmd[1] == 0x42)
    {
        uint8_t motor_addr = g_emm_rx_cmd[3];
        uint16_t subdivision = (g_emm_rx_cmd[4] << 8) | g_emm_rx_cmd[5];
        
        printf("[ç”µæœºå‚æ•°]\r\n");
        printf("åœ°å€: 0x%02X\r\n", motor_addr);
        printf("ç»†åˆ†: %u è„‰å†²/åœˆ\r\n", subdivision);
        
        // æ›´å¤šå‚æ•°è§æ–‡æ¡£: Docs/doc_Y57/03-æ§åˆ¶å‘½ä»¤è¯¦è§£.md
    }
}
```

---

## 4. å®æˆ˜ç¤ºä¾‹ä»£ç 

### 4.1 ç¤ºä¾‹1ï¼šæŒ‰é”®æ§åˆ¶ç”µæœºè½¬åŠ¨

**åŠŸèƒ½**ï¼šKEY0æŒ‰ä¸‹ç”µæœºè½¬1åœˆï¼ŒWKUPæŒ‰ä¸‹ç”µæœºè½¬åŠåœˆ

```c
// Core/App/motor_zdt.c

void motor_zdt_demo(void)
{
    uint8_t key;
    static uint8_t motor_enabled = 0;
    
    key = key_scan(0);
    
    if (key == KEY0_PRES)  // PC13æŒ‰é”®
    {
        if (!motor_enabled)
        {
            printf("ä½¿èƒ½ç”µæœº...\r\n");
            Emm_V5_En_Control(0x01, true, false);
            motor_enabled = 1;
            HAL_Delay(50);
        }
        
        printf("ç”µæœºè½¬åŠ¨1åœˆ\r\n");
        Emm_V5_Pos_Control(0x01, 0, 300, 10, 3200, false, false);
        led_toggle();  // LEDé—ªçƒæç¤º
    }
    else if (key == WKUP_PRES)  // PA0æŒ‰é”®
    {
        if (!motor_enabled)
        {
            printf("ä½¿èƒ½ç”µæœº...\r\n");
            Emm_V5_En_Control(0x01, true, false);
            motor_enabled = 1;
            HAL_Delay(50);
        }
        
        printf("ç”µæœºè½¬åŠ¨åŠåœˆ\r\n");
        Emm_V5_Pos_Control(0x01, 1, 300, 10, 1600, false, false);
        led_toggle();
    }
    
    // å¤„ç†ç”µæœºå“åº”
    if (g_emm_frame_complete)
    {
        g_emm_frame_complete = 0;
        
        if (g_emm_rx_count >= 4)
        {
            printf("[ç”µæœºå“åº”] Addr:0x%02X Cmd:0x%02X Status:0x%02X\r\n",
                   g_emm_rx_cmd[0], g_emm_rx_cmd[1], g_emm_rx_cmd[2]);
        }
    }
}
```

---

### 4.2 ç¤ºä¾‹2ï¼šä¸²å£å‘½ä»¤æ§åˆ¶

**åŠŸèƒ½**ï¼šé€šè¿‡USART1å‘é€å‘½ä»¤æ§åˆ¶ç”µæœº

```c
// åœ¨main.cä¸»å¾ªç¯æ·»åŠ 
void parse_uart_command(void)
{
    static char cmd_buf[32];
    static uint8_t cmd_len = 0;
    
    // æ¥æ”¶USART1æ•°æ®ï¼ˆç®€åŒ–ç‰ˆï¼Œç”Ÿäº§ä»£ç éœ€ä½¿ç”¨IDLEä¸­æ–­ï¼‰
    if (__HAL_UART_GET_FLAG(&g_uart1_handle, UART_FLAG_RXNE))
    {
        char ch = USART1->DR;
        
        if (ch == '\r' || ch == '\n')
        {
            if (cmd_len > 0)
            {
                cmd_buf[cmd_len] = '\0';
                
                // è§£æå‘½ä»¤
                if (strcmp(cmd_buf, "enable") == 0)
                {
                    Emm_V5_En_Control(0x01, true, false);
                    printf("ç”µæœºå·²ä½¿èƒ½\r\n");
                }
                else if (strcmp(cmd_buf, "disable") == 0)
                {
                    Emm_V5_En_Control(0x01, false, false);
                    printf("ç”µæœºå·²å¤±èƒ½\r\n");
                }
                else if (strncmp(cmd_buf, "move ", 5) == 0)
                {
                    int pulse = atoi(&cmd_buf[5]);
                    Emm_V5_Pos_Control(0x01, 0, 300, 10, pulse, false, false);
                    printf("ç”µæœºè½¬åŠ¨ %d è„‰å†²\r\n", pulse);
                }
                else if (strcmp(cmd_buf, "home") == 0)
                {
                    Emm_V5_Origin_Trigger_Return(0x01, 0, false);
                    printf("å¼€å§‹å›é›¶\r\n");
                }
                else
                {
                    printf("æœªçŸ¥å‘½ä»¤: %s\r\n", cmd_buf);
                }
                
                cmd_len = 0;
            }
        }
        else if (cmd_len < 31)
        {
            cmd_buf[cmd_len++] = ch;
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹ï¼ˆä¸²å£åŠ©æ‰‹ï¼‰ï¼š
// å‘é€: enable\r\n    â†’ ä½¿èƒ½ç”µæœº
// å‘é€: move 3200\r\n â†’ è½¬1åœˆ
// å‘é€: home\r\n      â†’ å›é›¶
// å‘é€: disable\r\n   â†’ å¤±èƒ½
```

---

### 4.3 ç¤ºä¾‹3ï¼šå®šæ—¶è‡ªåŠ¨è¿è¡Œ

**åŠŸèƒ½**ï¼šç”µæœºæ¯5ç§’è‡ªåŠ¨æ­£åè½¬ä¸€æ¬¡

```c
void motor_auto_run(void)
{
    static uint32_t last_time = 0;
    static uint8_t direction = 0;
    
    uint32_t current_time = HAL_GetTick();
    
    if (current_time - last_time >= 5000)  // 5ç§’é—´éš”
    {
        last_time = current_time;
        
        // åˆ‡æ¢æ–¹å‘
        direction = !direction;
        
        printf("è‡ªåŠ¨è¿è¡Œ: %s\r\n", direction ? "é€†æ—¶é’ˆ" : "é¡ºæ—¶é’ˆ");
        Emm_V5_Pos_Control(0x01, direction, 400, 15, 3200, false, false);
    }
}

// main.cä¸»å¾ªç¯
while (1)
{
    motor_auto_run();
    HAL_Delay(10);
}
```

---

### 4.4 ç¤ºä¾‹4ï¼šé€Ÿåº¦æ¸å˜æ§åˆ¶

**åŠŸèƒ½**ï¼šç”µæœºä»100RPMé€æ¸åŠ é€Ÿåˆ°1000RPM

```c
void motor_speed_ramp(void)
{
    printf("å¼€å§‹é€Ÿåº¦æ¸å˜æµ‹è¯•\r\n");
    Emm_V5_En_Control(0x01, true, false);
    HAL_Delay(100);
    
    // å¯åŠ¨é€Ÿåº¦æ¨¡å¼
    for (uint16_t speed = 100; speed <= 1000; speed += 100)
    {
        printf("é€Ÿåº¦: %u RPM\r\n", speed);
        Emm_V5_Vel_Control(0x01, 0, speed, 20, false);
        HAL_Delay(3000);  // æ¯ä¸ªé€Ÿåº¦æŒç»­3ç§’
    }
    
    // åœæ­¢
    Emm_V5_Stop_Now(0x01, false);
    printf("æµ‹è¯•å®Œæˆ\r\n");
}
```

---

## 5. å¸¸è§é—®é¢˜ä¸è°ƒè¯•

### 5.1 ç”µæœºæ— å“åº”

**ç—‡çŠ¶**ï¼šå‘é€å‘½ä»¤åç”µæœºä¸åŠ¨ï¼ŒCOM7æ— å“åº”å¸§

**æ’æŸ¥æ¸…å•**ï¼š

- [ ] **æ£€æŸ¥ä¾›ç”µ**
  ```c
  // ç”¨ä¸‡ç”¨è¡¨æµ‹é‡ç”µæœºé©±åŠ¨å™¨æŒ‡ç¤ºç¯æ˜¯å¦äº®
  // 24Vç”µæºç”µå‹åº”åœ¨23-25Vä¹‹é—´
  ```

- [ ] **æ£€æŸ¥RS485æ¥çº¿**
  ```c
  // ç¡®è®¤A-A, B-Bè¿æ¥
  // æµ‹è¯•ä»£ç ï¼š
  const char *test = "TEST\r\n";
  HAL_UART_Transmit(&g_uart2_handle, (uint8_t*)test, 6, 100);
  // COM7åº”æ”¶åˆ°"TEST"
  ```

- [ ] **æ£€æŸ¥ç”µæœºåœ°å€**
  ```c
  // å°è¯•å¹¿æ’­åœ°å€0x00
  Emm_V5_En_Control(0x00, true, false);
  ```

- [ ] **æ£€æŸ¥ç”µæœºæ˜¯å¦ä½¿èƒ½**
  ```c
  // å¿…é¡»å…ˆä½¿èƒ½
  Emm_V5_En_Control(0x01, true, false);
  HAL_Delay(50);  // ç­‰å¾…ä½¿èƒ½å®Œæˆ
  ```

---

### 5.2 ç”µæœºæŠ–åŠ¨/ä¸¢æ­¥

**ç—‡çŠ¶**ï¼šç”µæœºè¿è¡Œæ—¶æŠ–åŠ¨ï¼Œå®é™…è½¬åŠ¨è§’åº¦å°äºé¢„æœŸ

**å¯èƒ½åŸå› ä¸è§£å†³**ï¼š

1. **åŠ é€Ÿåº¦è¿‡é«˜**
   ```c
   // é™ä½åŠ é€Ÿåº¦å‚æ•°
   Emm_V5_Pos_Control(0x01, 0, 300, 5, 3200, false, false);  // acc=5
   ```

2. **é€Ÿåº¦è¿‡é«˜**
   ```c
   // é™ä½é€Ÿåº¦
   Emm_V5_Pos_Control(0x01, 0, 200, 10, 3200, false, false);  // 200RPM
   ```

3. **è´Ÿè½½è¿‡é‡**
   ```c
   // æ£€æŸ¥æœºæ¢°ä¼ åŠ¨æ˜¯å¦å¡æ»
   // æ‰‹åŠ¨è½¬åŠ¨ç”µæœºè½´åº”è¾ƒè½»æ¾
   ```

4. **ç”µå‹ä¸è¶³**
   ```c
   // æµ‹é‡24Vç”µæºï¼Œè´Ÿè½½æ—¶ä¸åº”ä½äº22V
   ```

---

### 5.3 é€šä¿¡å¸§è§£æé”™è¯¯

**ç—‡çŠ¶**ï¼šæ¥æ”¶åˆ°å“åº”å¸§ä½†å†…å®¹é”™è¯¯

**è°ƒè¯•æ–¹æ³•**ï¼š

```c
// æ‰“å°åŸå§‹æ¥æ”¶æ•°æ®
if (g_emm_frame_complete)
{
    g_emm_frame_complete = 0;
    
    printf("[RAW] Recv %u bytes: ", g_emm_rx_count);
    for (uint8_t i = 0; i < g_emm_rx_count; i++)
    {
        printf("%02X ", g_emm_rx_cmd[i]);
    }
    printf("\r\n");
    
    // æ£€æŸ¥æ ¡éªŒå­—èŠ‚
    if (g_emm_rx_cmd[g_emm_rx_count - 1] != 0x6B)
    {
        printf("æ ¡éªŒé”™è¯¯ï¼æœ€åå­—èŠ‚åº”ä¸º0x6B\r\n");
    }
}
```

**å¸¸è§é”™è¯¯å¸§**ï¼š

| é”™è¯¯ç°è±¡ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|
| ç¬¬1å­—èŠ‚ä¸æ˜¯åœ°å€ | FIFOæº¢å‡º/å¸§åŒæ­¥é”™è¯¯ | æ£€æŸ¥IDLEä¸­æ–­æ˜¯å¦æ­£å¸¸è§¦å‘ |
| æœ€åå­—èŠ‚ä¸æ˜¯0x6B | é€šä¿¡å¹²æ‰°/æ³¢ç‰¹ç‡é”™è¯¯ | æ£€æŸ¥RS485å¸ƒçº¿ï¼Œé™ä½æ³¢ç‰¹ç‡ |
| å¸§é•¿åº¦ä¸å¯¹ | æ¥æ”¶æœªå®Œæˆå°±å¤„ç† | å¢åŠ IDLEä¸­æ–­å»¶æ—¶åˆ¤æ–­ |

---

### 5.4 å¤šæœºé€šä¿¡å†²çª

**ç—‡çŠ¶**ï¼šå•ç‹¬æ§åˆ¶æ¯ä¸ªç”µæœºæ­£å¸¸ï¼ŒåŒæ—¶æ§åˆ¶æ—¶å“åº”æ··ä¹±

**åŸå› **ï¼šRS485åŠåŒå·¥ï¼Œå¤šæœºåŒæ—¶å“åº”å¯¼è‡´æ€»çº¿å†²çª

**è§£å†³æ–¹æ¡ˆ**ï¼š

```c
// æ–¹æ³•1ï¼šé¡ºåºæ§åˆ¶ï¼ˆå¸¦å»¶æ—¶ï¼‰
Emm_V5_Pos_Control(0x01, 0, 300, 10, 3200, false, false);
HAL_Delay(100);  // ç­‰å¾…ç”µæœº1å“åº”
Emm_V5_Pos_Control(0x02, 0, 300, 10, 3200, false, false);
HAL_Delay(100);  // ç­‰å¾…ç”µæœº2å“åº”

// æ–¹æ³•2ï¼šä½¿ç”¨åŒæ­¥æ¨¡å¼ï¼ˆæ¨èï¼‰
Emm_V5_Pos_Control(0x01, 0, 300, 10, 3200, false, true);  // snF=true
HAL_Delay(50);
Emm_V5_Pos_Control(0x02, 0, 300, 10, 3200, false, true);
HAL_Delay(50);
Emm_V5_Synchronous_motion(0x00);  // ç»Ÿä¸€å¯åŠ¨ï¼Œæ— å“åº”å¸§å†²çª

// æ–¹æ³•3ï¼šå…³é—­éƒ¨åˆ†ç”µæœºå“åº”ï¼ˆä¿®æ”¹ç”µæœºå‚æ•°ï¼‰
// å‚è€ƒæ–‡æ¡£: Docs/doc_Y57/06-å¤šæœºé€šè®¯.md
```

---

### 5.5 å›é›¶å¤±è´¥

**ç—‡çŠ¶**ï¼šå›é›¶å‘½ä»¤å‘é€åç”µæœºæŒç»­è½¬åŠ¨ä¸åœ

**æ’æŸ¥**ï¼š

1. **æ£€æŸ¥å›é›¶æ¨¡å¼æ˜¯å¦åŒ¹é…**
   ```c
   // æ— é™ä½å¼€å…³ä¸èƒ½ä½¿ç”¨æ¨¡å¼3
   Emm_V5_Origin_Trigger_Return(0x01, 0, false);  // æ¨¡å¼0
   ```

2. **æ£€æŸ¥é›¶ç‚¹æ˜¯å¦å·²è®¾ç½®**
   ```c
   // é¦–æ¬¡ä½¿ç”¨éœ€å…ˆæ‰‹åŠ¨è®¾ç½®é›¶ç‚¹
   // æ‰‹åŠ¨è½¬åŠ¨ç”µæœºåˆ°æœŸæœ›é›¶ç‚¹ä½ç½®
   Emm_V5_Origin_Set_Zero(0x01, false);  // è®¾ç½®å½“å‰ä½ç½®ä¸ºé›¶ç‚¹
   HAL_Delay(100);
   ```

3. **æŸ¥çœ‹å›é›¶å‚æ•°**
   ```c
   // è¯»å–ç³»ç»Ÿå‚æ•°æ£€æŸ¥å›é›¶æ¨¡å¼è®¾ç½®
   Emm_V5_Read_Sys_Params(0x01);
   ```

---

## ğŸ¯ æ€»ç»“ä¸ä¸‹ä¸€æ­¥

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œæ‚¨å·²æŒæ¡ï¼š
- âœ… å¼ å¤§å¤´Yç³»åˆ—ç”µæœºç¡¬ä»¶å‚æ•°ä¸æ¥çº¿
- âœ… Emm_V5é€šä¿¡åè®®å¸§æ ¼å¼
- âœ… FIFOæ¥æ”¶æœºåˆ¶åŸç†
- âœ… 15ä¸ªæ ¸å¿ƒAPIå‡½æ•°ä½¿ç”¨
- âœ… ä½ç½®/é€Ÿåº¦/å›é›¶/åŒæ­¥æ§åˆ¶å®æˆ˜
- âœ… å¸¸è§é—®é¢˜è°ƒè¯•æ–¹æ³•

**å®æˆ˜é¡¹ç›®å»ºè®®**ï¼š
1. **ç®€æ˜“CNCé›•åˆ»æœº**ï¼šXYåŒè½´æ’è¡¥è¿åŠ¨
2. **è‡ªåŠ¨äº‘å°**ï¼šä¿¯ä»°+æ—‹è½¬åŒè½´åŒæ­¥
3. **åˆ†æ‹£æœºæ¢°è‡‚**ï¼šå¤šå…³èŠ‚å›é›¶+å®šä½æŠ“å–
4. **è‡ªåŠ¨é—¨æ§åˆ¶**ï¼šé™ä½å¼€å…³+è½¯é™ä½ä¿æŠ¤

**è¿›é˜¶å­¦ä¹ **ï¼š
- ğŸ“– **å®Œæ•´åè®®æ–‡æ¡£**: [Docs/doc_Y57/README.md](../doc_Y57/README.md)
- ğŸ“– **STM32é›†æˆæŒ‡å—**: [Docs/doc_Y57/07-STM32é›†æˆæŒ‡å—.md](../doc_Y57/07-STM32é›†æˆæŒ‡å—.md)
- ğŸ’» **æ ‡å‡†åº“ä¾‹ç¨‹**: [Docs/STM32_ZDT_PosMode/](../STM32_ZDT_PosMode/)ï¼ˆå¯¹æ¯”å­¦ä¹ ï¼‰

---

**è¿”å›**: [00-é¡¹ç›®æ€»è§ˆ](./00-é¡¹ç›®æ€»è§ˆ.md) | **ä¸Šä¸€ç¯‡**: [06-è°ƒè¯•æŠ€å·§ä¸é—®é¢˜æ’æŸ¥](./06-è°ƒè¯•æŠ€å·§ä¸é—®é¢˜æ’æŸ¥.md)

---

**ğŸ‰ æ­å–œå®Œæˆå…¨éƒ¨7ç« æ–‡æ¡£å­¦ä¹ ï¼ç°åœ¨å¼€å§‹æ‚¨çš„ç”µæœºæ§åˆ¶é¡¹ç›®å§ï¼**
