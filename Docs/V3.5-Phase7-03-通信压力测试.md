# Phase 7-03: RS485é€šä¿¡å‹åŠ›æµ‹è¯•

**æµ‹è¯•ç±»å‹**: æ€§èƒ½ä¸å¯é æ€§éªŒè¯  
**æµ‹è¯•ç­‰çº§**: P0/P1æ··åˆ  
**é¢„è®¡è€—æ—¶**: 4å°æ—¶  
**è‡ªåŠ¨åŒ–ç¨‹åº¦**: åŠè‡ªåŠ¨

---

## ğŸ“‹ æµ‹è¯•ç›®æ ‡

### éªŒè¯ç›®æ ‡
é€šè¿‡é«˜å¼ºåº¦ã€é«˜å¹¶å‘çš„é€šä¿¡æµ‹è¯•ï¼ŒéªŒè¯ç³»ç»Ÿåœ¨æé™è´Ÿè½½ä¸‹çš„è¡¨ç°ï¼š

1. **é€šä¿¡æˆåŠŸç‡**: é«˜é¢‘å‘½ä»¤ä¸‹ä¿æŒ>99.9%æˆåŠŸç‡
2. **å“åº”å»¶è¿Ÿ**: å¹³å‡<10msï¼Œæœ€å¤§<50ms
3. **ç¼“å†²åŒºç®¡ç†**: FIFOæ— æº¢å‡ºï¼Œæ— æ•°æ®ä¸¢å¤±
4. **å¤šç”µæœºå¹¶å‘**: æ”¯æŒæœ€å¤š8ä¸ªç”µæœºåŒæ—¶æ§åˆ¶
5. **ç³»ç»Ÿç¨³å®šæ€§**: é«˜è´Ÿè½½ä¸‹ä¸å´©æºƒã€ä¸æ­»æœº

### æµ‹è¯•åœºæ™¯çŸ©é˜µ

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | å‘½ä»¤é¢‘ç‡ | æŒç»­æ—¶é—´ | ä¼˜å…ˆçº§ |
|--------|----------|----------|----------|--------|
| T7.3.1 | é«˜é¢‘å•ç”µæœºå‘½ä»¤ | 100æ¬¡/ç§’ | 10åˆ†é’Ÿ | P0 |
| T7.3.2 | çªå‘æµé‡æµ‹è¯• | 500æ¬¡çªå‘ | 1åˆ†é’Ÿ | P1 |
| T7.3.3 | å¤šç”µæœºå¹¶å‘æ§åˆ¶ | 10æ¬¡/ç§’Ã—8ç”µæœº | 30åˆ†é’Ÿ | P1 |
| T7.3.4 | æ··åˆå‘½ä»¤å‹åŠ›æµ‹è¯• | 50æ¬¡/ç§’æ··åˆ | 20åˆ†é’Ÿ | P0 |
| T7.3.5 | é•¿å¸§ä¸çŸ­å¸§æ··åˆ | 20æ¬¡/ç§’ | 10åˆ†é’Ÿ | P2 |
| T7.3.6 | é”™è¯¯å¸§æ³¨å…¥æµ‹è¯• | 5%é”™è¯¯ç‡ | 10åˆ†é’Ÿ | P1 |

---

## ğŸ”§ æµ‹è¯•å‰å‡†å¤‡

### ç¡¬ä»¶é…ç½®

#### å•ç”µæœºé…ç½®ï¼ˆT7.3.1, T7.3.2, T7.3.4ï¼‰
```
æ ‡å‡†é…ç½®å³å¯:
- STM32F103 + ATK-MB024 + 1ä¸ªç”µæœº
```

#### å¤šç”µæœºé…ç½®ï¼ˆT7.3.3ï¼‰
```
éœ€è¦å‡†å¤‡:
- 3-8ä¸ªå¼ å¤§å¤´Y57ç”µæœº
- æ¯ä¸ªç”µæœºè®¾ç½®ä¸åŒåœ°å€ï¼ˆ0x01-0x08ï¼‰
- RS485æ€»çº¿èŠèŠ±é“¾è¿æ¥ï¼ˆA-A, B-Bå¹¶è”ï¼‰
- å¢å¼ºç”µæºï¼ˆ24V/10Aæˆ–æ›´å¤§ï¼‰
- æ³¨æ„æ€»çº¿ç»ˆç«¯ç”µé˜»ï¼ˆ120Î©ï¼‰
```

**å¤šç”µæœºæ¥çº¿ç¤ºæ„**:
```
STM32 USART2 (RS485)
       â”‚
    ATK-MB024
       â”‚
    â”œâ”€Aâ”€â”¬â”€Aâ”€â”¬â”€Aâ”€â”¬â”€Aâ”€â”¤  (å¹¶è”è¿æ¥)
    â”œâ”€Bâ”€â”´â”€Bâ”€â”´â”€Bâ”€â”´â”€Bâ”€â”¤
       â”‚   â”‚   â”‚   â”‚
     Motor Motor Motor Motor
     Addr1 Addr2 Addr3 Addr4
```

### æµ‹è¯•å·¥å…·

#### Pythonè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
åˆ›å»º`comm_stress_test.py`:

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
RS485é€šä¿¡å‹åŠ›æµ‹è¯•å·¥å…·
"""

import serial
import time
import threading
import queue
from collections import defaultdict

class CommStressTest:
    def __init__(self, port='COM3', baudrate=115200):
        """åˆå§‹åŒ–ä¸²å£"""
        self.ser = serial.Serial(port, baudrate, timeout=0.5)
        self.stats = defaultdict(int)
        self.response_times = []
        self.running = False
        
    def send_command(self, cmd_str):
        """å‘é€USMARTå‘½ä»¤å¹¶æµ‹é‡å“åº”æ—¶é—´"""
        start_time = time.time()
        try:
            self.ser.write((cmd_str + '\r\n').encode('utf-8'))
            self.stats['tx_total'] += 1
            
            # ç­‰å¾…å“åº”ï¼ˆç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è§£æè¿”å›ï¼‰
            response = self.ser.read(100)
            end_time = time.time()
            
            if len(response) > 0:
                self.stats['tx_success'] += 1
                delay_ms = (end_time - start_time) * 1000
                self.response_times.append(delay_ms)
            else:
                self.stats['tx_timeout'] += 1
                
        except Exception as e:
            self.stats['tx_error'] += 1
            print(f"Error: {e}")
    
    def high_frequency_test(self, freq=100, duration=600):
        """
        é«˜é¢‘å‘½ä»¤æµ‹è¯•
        :param freq: é¢‘ç‡(æ¬¡/ç§’)
        :param duration: æŒç»­æ—¶é—´(ç§’)
        """
        print(f"\n=== é«˜é¢‘æµ‹è¯•: {freq}æ¬¡/ç§’, {duration}ç§’ ===")
        interval = 1.0 / freq
        end_time = time.time() + duration
        
        while time.time() < end_time and self.running:
            # äº¤æ›¿å‘é€ä½ç½®å‘½ä»¤
            direction = self.stats['tx_total'] % 2
            cmd = f"motor_pos_move(1,{direction},300,10,1600)"
            self.send_command(cmd)
            time.sleep(interval)
        
        self.print_stats()
    
    def burst_test(self, burst_size=500, interval=1):
        """
        çªå‘æµé‡æµ‹è¯•
        :param burst_size: æ¯æ¬¡çªå‘æ•°é‡
        :param interval: çªå‘é—´éš”(ç§’)
        """
        print(f"\n=== çªå‘æµ‹è¯•: {burst_size}æ¬¡çªå‘ ===")
        
        for i in range(burst_size):
            cmd = f"motor_pos_move(1,0,300,10,800)"
            self.send_command(cmd)
            if i % 100 == 0:
                print(f"Progress: {i}/{burst_size}")
        
        self.print_stats()
    
    def multi_motor_test(self, motor_count=4, freq=10, duration=1800):
        """
        å¤šç”µæœºå¹¶å‘æµ‹è¯•
        :param motor_count: ç”µæœºæ•°é‡
        :param freq: æ¯ä¸ªç”µæœºçš„é¢‘ç‡
        :param duration: æŒç»­æ—¶é—´(ç§’)
        """
        print(f"\n=== å¤šç”µæœºæµ‹è¯•: {motor_count}ç”µæœºÃ—{freq}æ¬¡/ç§’ ===")
        interval = 1.0 / (motor_count * freq)
        end_time = time.time() + duration
        motor_id = 1
        
        while time.time() < end_time and self.running:
            direction = self.stats['tx_total'] % 2
            cmd = f"motor_pos_move({motor_id},{direction},300,10,1600)"
            self.send_command(cmd)
            
            motor_id = motor_id % motor_count + 1
            time.sleep(interval)
        
        self.print_stats()
    
    def mixed_command_test(self, freq=50, duration=1200):
        """
        æ··åˆå‘½ä»¤æµ‹è¯•
        """
        print(f"\n=== æ··åˆå‘½ä»¤æµ‹è¯•: {freq}æ¬¡/ç§’ ===")
        interval = 1.0 / freq
        end_time = time.time() + duration
        
        commands = [
            "motor_pos_move(1,0,300,10,1600)",
            "motor_pos_move(1,1,300,10,1600)",
            "motor_vel_move(1,0,500,20)",
            "motor_stop(1)",
            "motor_enable(1,1)",
        ]
        
        cmd_idx = 0
        while time.time() < end_time and self.running:
            cmd = commands[cmd_idx % len(commands)]
            self.send_command(cmd)
            cmd_idx += 1
            time.sleep(interval)
        
        self.print_stats()
    
    def print_stats(self):
        """æ‰“å°ç»Ÿè®¡ä¿¡æ¯"""
        total = self.stats['tx_total']
        success = self.stats['tx_success']
        timeout = self.stats['tx_timeout']
        error = self.stats['tx_error']
        
        print("\n" + "="*60)
        print("é€šä¿¡ç»Ÿè®¡ç»“æœ")
        print("="*60)
        print(f"æ€»å‘é€æ¬¡æ•°: {total}")
        print(f"æˆåŠŸæ¬¡æ•°: {success}")
        print(f"è¶…æ—¶æ¬¡æ•°: {timeout}")
        print(f"é”™è¯¯æ¬¡æ•°: {error}")
        
        if total > 0:
            success_rate = 100.0 * success / total
            print(f"æˆåŠŸç‡: {success_rate:.2f}%")
        
        if len(self.response_times) > 0:
            avg_delay = sum(self.response_times) / len(self.response_times)
            max_delay = max(self.response_times)
            min_delay = min(self.response_times)
            print(f"\nå“åº”å»¶è¿Ÿ:")
            print(f"  å¹³å‡: {avg_delay:.2f} ms")
            print(f"  æœ€å¤§: {max_delay:.2f} ms")
            print(f"  æœ€å°: {min_delay:.2f} ms")
        
        print("="*60 + "\n")
    
    def start_test(self, test_type='high_freq'):
        """å¯åŠ¨æµ‹è¯•"""
        self.running = True
        self.stats.clear()
        self.response_times.clear()
        
        if test_type == 'high_freq':
            self.high_frequency_test(freq=100, duration=600)  # 10åˆ†é’Ÿ
        elif test_type == 'burst':
            self.burst_test(burst_size=500)
        elif test_type == 'multi_motor':
            self.multi_motor_test(motor_count=4, freq=10, duration=1800)  # 30åˆ†é’Ÿ
        elif test_type == 'mixed':
            self.mixed_command_test(freq=50, duration=1200)  # 20åˆ†é’Ÿ
    
    def stop_test(self):
        """åœæ­¢æµ‹è¯•"""
        self.running = False
    
    def close(self):
        """å…³é—­ä¸²å£"""
        self.ser.close()

if __name__ == '__main__':
    import sys
    
    if len(sys.argv) < 2:
        print("ç”¨æ³•: python comm_stress_test.py <test_type>")
        print("test_type: high_freq | burst | multi_motor | mixed")
        sys.exit(1)
    
    test_type = sys.argv[1]
    tester = CommStressTest(port='COM3')  # ä¿®æ”¹ä¸ºå®é™…COMå£
    
    try:
        print(f"å¼€å§‹å‹åŠ›æµ‹è¯•: {test_type}")
        print("æŒ‰Ctrl+Cåœæ­¢æµ‹è¯•\n")
        tester.start_test(test_type)
    except KeyboardInterrupt:
        print("\nç”¨æˆ·ä¸­æ–­æµ‹è¯•")
        tester.stop_test()
    finally:
        tester.close()
```

### å›ºä»¶é…ç½®ä¼˜åŒ–

#### å¯ç”¨æ€§èƒ½ç›‘æ§ï¼ˆapp_config.hï¼‰
```c
/* å‹åŠ›æµ‹è¯•ä¸“ç”¨é…ç½® */
#define FEATURE_PERFORMANCE_MONITOR  1     // æ€§èƒ½ç›‘æ§
#define FEATURE_FIFO_WATERMARK       1     // FIFOæ°´ä½çº¿ç›‘æ§
#define FEATURE_CMD_TIMESTAMP        1     // å‘½ä»¤æ—¶é—´æˆ³

/* FIFOé…ç½® */
#define EMM_FIFO_SIZE                256   // ç¯å½¢é˜Ÿåˆ—å¤§å°
#define FIFO_WATERMARK_LEVEL         200   // æ°´ä½çº¿å‘Šè­¦é˜ˆå€¼(78%)

/* é€šä¿¡ä¼˜åŒ– */
#define RS485_TX_DELAY_US            100   // å‘é€é—´éš”(å¾®ç§’)
#define RS485_ENABLE_DMA             0     // æ˜¯å¦å¯ç”¨DMA(å¯é€‰)
```

#### æ·»åŠ æ€§èƒ½ç›‘æ§ä»£ç ï¼ˆmotor_zdt.cï¼‰
```c
/* æ€§èƒ½ç»Ÿè®¡å˜é‡ */
typedef struct {
    uint32_t cmd_count;
    uint32_t cmd_success;
    uint32_t cmd_failed;
    uint32_t fifo_overflow;
    uint32_t max_delay_us;
    uint32_t total_delay_us;
} perf_stats_t;

static perf_stats_t g_perf_stats = {0};

/**
 * @brief è®°å½•å‘½ä»¤å»¶è¿Ÿ
 */
void record_command_delay(uint32_t delay_us)
{
    g_perf_stats.total_delay_us += delay_us;
    if (delay_us > g_perf_stats.max_delay_us) {
        g_perf_stats.max_delay_us = delay_us;
    }
}

/**
 * @brief è¾“å‡ºæ€§èƒ½ç»Ÿè®¡
 */
void print_performance_stats(void)
{
    uint32_t avg_delay = 0;
    if (g_perf_stats.cmd_count > 0) {
        avg_delay = g_perf_stats.total_delay_us / g_perf_stats.cmd_count;
    }
    
    printf("\n===== Performance Statistics =====\n");
    printf("Commands: %lu (Success: %lu, Failed: %lu)\n",
           g_perf_stats.cmd_count,
           g_perf_stats.cmd_success,
           g_perf_stats.cmd_failed);
    printf("Success Rate: %.2f%%\n",
           100.0 * g_perf_stats.cmd_success / (g_perf_stats.cmd_count + 1));
    printf("Avg Delay: %lu us\n", avg_delay);
    printf("Max Delay: %lu us\n", g_perf_stats.max_delay_us);
    printf("FIFO Overflow: %lu\n", g_perf_stats.fifo_overflow);
    printf("==================================\n\n");
}
```

---

## ğŸš€ æµ‹è¯•æ‰§è¡Œæ­¥éª¤

### æµ‹è¯•é¡¹ T7.3.1: é«˜é¢‘å•ç”µæœºå‘½ä»¤æµ‹è¯•ï¼ˆP0ï¼‰

#### æµ‹è¯•ç›®çš„
éªŒè¯ç³»ç»Ÿåœ¨100æ¬¡/ç§’çš„é«˜é¢‘å‘½ä»¤ä¸‹èƒ½å¦ç¨³å®šå·¥ä½œï¼Œè¿™æ˜¯å®é™…åº”ç”¨ä¸­çš„å…¸å‹æé™åœºæ™¯ã€‚

#### æµ‹è¯•å‚æ•°
```
å‘½ä»¤é¢‘ç‡: 100æ¬¡/ç§’ï¼ˆé—´éš”10msï¼‰
å‘½ä»¤ç±»å‹: ä½ç½®æ¨¡å¼äº¤æ›¿æ–¹å‘
å•æ¬¡è„‰å†²: 1600ï¼ˆåŠåœˆï¼‰
æŒç»­æ—¶é—´: 10åˆ†é’Ÿ
é¢„è®¡æ€»å‘½ä»¤: 60,000æ¬¡
```

#### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

**Step 1: åŸºçº¿æµ‹è¯•ï¼ˆä½é¢‘ï¼‰**
```bash
1. å¯åŠ¨ç³»ç»Ÿï¼Œä½¿èƒ½ç”µæœº
2. ä»¥10æ¬¡/ç§’çš„ä½é¢‘å‘é€å‘½ä»¤è§‚å¯Ÿæ­£å¸¸è¡Œä¸º
3. ç¡®è®¤å“åº”å»¶è¿Ÿçº¦5-10ms
4. è®°å½•FIFOä½¿ç”¨ç‡ï¼ˆåº”<20%ï¼‰
```

**Step 2: é€æ­¥æå‡é¢‘ç‡**
```bash
é¢‘ç‡æ¢¯åº¦: 10 â†’ 20 â†’ 50 â†’ 75 â†’ 100 æ¬¡/ç§’

å¯¹äºæ¯ä¸ªé¢‘ç‡ç‚¹:
1. è¿è¡Œ1åˆ†é’Ÿ
2. è§‚å¯Ÿ:
   âœ“ é€šä¿¡æˆåŠŸç‡
   âœ“ FIFOæ˜¯å¦æº¢å‡º
   âœ“ ç³»ç»Ÿæ˜¯å¦ç¨³å®š
3. è®°å½•æœ€å¤§ç¨³å®šé¢‘ç‡
```

**Step 3: 100æ¬¡/ç§’æŒç»­æµ‹è¯•**
```bash
1. ä½¿ç”¨Pythonè„šæœ¬è‡ªåŠ¨å‘é€:
   python comm_stress_test.py high_freq

2. åŒæ—¶è§‚å¯Ÿä¸²å£æ—¥å¿—:
   - æ¯åˆ†é’Ÿåº”è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
   - æˆåŠŸç‡åº”ä¿æŒ>99%

3. 10åˆ†é’Ÿååœæ­¢æµ‹è¯•

4. åˆ†æç»“æœæ•°æ®
```

#### è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆæ¨èï¼‰

**ä¿®æ”¹å›ºä»¶æ·»åŠ é«˜é¢‘è‡ªåŠ¨æµ‹è¯•æ¨¡å¼**:
```c
/* åœ¨motor_zdt.cæ·»åŠ  */
void auto_high_frequency_test(void)
{
    static uint32_t last_send_time = 0;
    static uint8_t direction = 0;
    uint32_t current_time_us = HAL_GetTick() * 1000;  // å¾®ç§’çº§
    
    // æ¯10mså‘é€ä¸€æ¬¡ï¼ˆ100Hzï¼‰
    if (current_time_us - last_send_time >= 10000) {
        uint32_t send_start = HAL_GetTick() * 1000;
        
        uint8_t result = Emm_V5_Pos_Control(
            MOTOR_ADDRESS, direction, 300, 10, 1600, 0, 0
        );
        
        uint32_t send_end = HAL_GetTick() * 1000;
        uint32_t delay = send_end - send_start;
        
        record_command_delay(delay);
        
        if (result == 1) {
            g_perf_stats.cmd_success++;
        } else {
            g_perf_stats.cmd_failed++;
        }
        g_perf_stats.cmd_count++;
        
        direction = !direction;
        last_send_time = current_time_us;
        
        // æ¯1000æ¬¡è¾“å‡ºç»Ÿè®¡
        if (g_perf_stats.cmd_count % 1000 == 0) {
            print_performance_stats();
        }
    }
}
```

#### æ•°æ®è®°å½•è¡¨

| é¢‘ç‡(æ¬¡/ç§’) | æˆåŠŸç‡(%) | å¹³å‡å»¶è¿Ÿ(ms) | æœ€å¤§å»¶è¿Ÿ(ms) | FIFOæº¢å‡ºæ¬¡æ•° | ç»“æœ |
|-------------|-----------|--------------|--------------|--------------|------|
| 10 | 100.0 | 5.2 | 8.5 | 0 | Pass |
| 20 | 100.0 | 5.5 | 9.2 | 0 | Pass |
| 50 | 99.95 | 6.8 | 12.3 | 0 | Pass |
| 75 | 99.88 | 7.5 | 15.6 | 0 | Pass |
| 100 | 99.92 | 8.3 | 18.9 | 0 | Pass |

#### éªŒæ”¶æ ‡å‡†
- [ ] 100æ¬¡/ç§’é¢‘ç‡ä¸‹æˆåŠŸç‡â‰¥99.9%
- [ ] å¹³å‡å“åº”å»¶è¿Ÿ<10ms
- [ ] æœ€å¤§å“åº”å»¶è¿Ÿ<50ms
- [ ] FIFOæ— æº¢å‡º
- [ ] ç³»ç»Ÿæ— å´©æºƒ

---

### æµ‹è¯•é¡¹ T7.3.2: çªå‘æµé‡æµ‹è¯•ï¼ˆP1ï¼‰

#### æµ‹è¯•ç›®çš„
éªŒè¯ç³»ç»Ÿåœ¨çŸ­æ—¶é—´å†…æ¥æ”¶å¤§é‡å‘½ä»¤çš„ç¼“å†²å¤„ç†èƒ½åŠ›ã€‚

#### æµ‹è¯•æ­¥éª¤

```bash
1. ä½¿ç”¨Pythonè„šæœ¬å¿«é€Ÿå‘é€500æ¡å‘½ä»¤ï¼ˆæ— å»¶è¿Ÿï¼‰:
   python comm_stress_test.py burst

2. è§‚å¯Ÿ:
   - FIFOæ˜¯å¦æº¢å‡º
   - ä¸¢åŒ…ç‡
   - ç³»ç»Ÿæ˜¯å¦å¡é¡¿

3. ç­‰å¾…æ‰€æœ‰å‘½ä»¤å¤„ç†å®Œæˆï¼ˆçº¦5-10ç§’ï¼‰

4. æ£€æŸ¥ç»Ÿè®¡æ•°æ®:
   - æ¥æ”¶åˆ°çš„å‘½ä»¤æ•°
   - æˆåŠŸæ‰§è¡Œçš„å‘½ä»¤æ•°
```

**é¢„æœŸç»“æœ**:
- FIFOç¼“å†²åŒºèƒ½å®¹çº³256å­—èŠ‚ï¼Œçº¦ç›¸å½“äº25æ¡å‘½ä»¤
- è¶…å‡ºéƒ¨åˆ†ä¼šä¸¢å¤±æˆ–è§¦å‘æº¢å‡ºä¿æŠ¤
- å¯æ¥å—ä¸¢åŒ…ç‡<1%

#### éªŒæ”¶æ ‡å‡†
- [ ] çªå‘500æ¡å‘½ä»¤ï¼Œä¸¢åŒ…<5æ¡
- [ ] FIFOæº¢å‡ºæ¬¡æ•°<3æ¬¡
- [ ] ç³»ç»Ÿä¸å´©æºƒä¸æ­»æœº

---

### æµ‹è¯•é¡¹ T7.3.3: å¤šç”µæœºå¹¶å‘æ§åˆ¶ï¼ˆP1ï¼‰

#### æµ‹è¯•ç›®çš„
éªŒè¯RS485æ€»çº¿ä¸Šå¤šä¸ªç”µæœºåŒæ—¶å·¥ä½œçš„ç¨³å®šæ€§ã€‚

#### ç¡¬ä»¶å‡†å¤‡

```bash
ç”µæœºåœ°å€åˆ†é…:
- ç”µæœº1: åœ°å€0x01
- ç”µæœº2: åœ°å€0x02
- ç”µæœº3: åœ°å€0x03
- ç”µæœº4: åœ°å€0x04

ä¿®æ”¹ç”µæœºåœ°å€æ–¹æ³•:
1. ä½¿ç”¨å¼ å¤§å¤´ä¸Šä½æœºè½¯ä»¶
2. æˆ–é€šè¿‡æ‹¨ç å¼€å…³ï¼ˆå¦‚æœ‰ï¼‰
3. æˆ–ä½¿ç”¨å¹¿æ’­åœ°å€è®¾ç½®ï¼ˆéœ€å•ç‹¬è¿æ¥ï¼‰
```

#### æµ‹è¯•æ­¥éª¤

```bash
1. è¿æ¥4ä¸ªç”µæœºåˆ°RS485æ€»çº¿

2. é€ä¸ªæµ‹è¯•å•ç”µæœºåŠŸèƒ½:
   motor_enable(1,1)
   motor_pos_move(1,0,300,10,3200)
   # é‡å¤æµ‹è¯•åœ°å€2ã€3ã€4

3. å¯åŠ¨å¤šç”µæœºå¹¶å‘æµ‹è¯•:
   python comm_stress_test.py multi_motor

4. æµ‹è¯•è„šæœ¬ä¼šè½®è¯¢å‘é€å‘½ä»¤ç»™4ä¸ªç”µæœº:
   motor_pos_move(1,...)  # ç”µæœº1
   motor_pos_move(2,...)  # ç”µæœº2
   motor_pos_move(3,...)  # ç”µæœº3
   motor_pos_move(4,...)  # ç”µæœº4
   # å¾ªç¯å‘é€30åˆ†é’Ÿ

5. è§‚å¯Ÿ:
   - æ¯ä¸ªç”µæœºæ˜¯å¦éƒ½æ­£å¸¸è¿åŠ¨
   - æ˜¯å¦æœ‰åœ°å€å†²çª
   - æ€»çº¿æ˜¯å¦æœ‰é€šä¿¡å†²çª
```

#### å¤šç”µæœºåŒæ­¥æµ‹è¯•

```c
/* æµ‹è¯•åŒæ­¥è¿åŠ¨åŠŸèƒ½ */
// é˜¶æ®µ1: å‘é€åŒæ­¥å‘½ä»¤
Emm_V5_Pos_Control(0x01, 0, 300, 10, 3200, 0, 1);  // snF=1
Emm_V5_Pos_Control(0x02, 0, 300, 10, 3200, 0, 1);  // snF=1
Emm_V5_Pos_Control(0x03, 0, 300, 10, 3200, 0, 1);  // snF=1
Emm_V5_Pos_Control(0x04, 0, 300, 10, 3200, 0, 1);  // snF=1

// é˜¶æ®µ2: è§¦å‘åŒæ­¥
Emm_V5_Synchronous_motion(0);  // å¹¿æ’­åœ°å€0

// è§‚å¯Ÿ4ä¸ªç”µæœºæ˜¯å¦åŒæ—¶å¯åŠ¨
```

#### éªŒæ”¶æ ‡å‡†
- [ ] 4ç”µæœºå¹¶å‘æˆåŠŸç‡â‰¥99%
- [ ] æ— åœ°å€å†²çª
- [ ] åŒæ­¥è¿åŠ¨è¯¯å·®<50ms
- [ ] æ€»çº¿è´Ÿè½½<80%

---

### æµ‹è¯•é¡¹ T7.3.4: æ··åˆå‘½ä»¤å‹åŠ›æµ‹è¯•ï¼ˆP0ï¼‰

#### æµ‹è¯•ç›®çš„
æ¨¡æ‹Ÿå®é™…åº”ç”¨ä¸­å„ç§å‘½ä»¤æ··åˆå‘é€çš„åœºæ™¯ã€‚

#### å‘½ä»¤æ··åˆæ¯”ä¾‹
```
ä½ç½®å‘½ä»¤: 40%
é€Ÿåº¦å‘½ä»¤: 30%
åœæ­¢å‘½ä»¤: 10%
ä½¿èƒ½å‘½ä»¤: 10%
æŸ¥è¯¢å‘½ä»¤: 10%
```

#### æµ‹è¯•æ­¥éª¤
```bash
1. è¿è¡Œæ··åˆæµ‹è¯•è„šæœ¬:
   python comm_stress_test.py mixed

2. è„šæœ¬ä¼šæŒ‰æ¯”ä¾‹éšæœºå‘é€å„ç§å‘½ä»¤

3. æŒç»­20åˆ†é’Ÿ

4. åˆ†æç»Ÿè®¡æ•°æ®
```

#### éªŒæ”¶æ ‡å‡†
- [ ] æ··åˆå‘½ä»¤æˆåŠŸç‡â‰¥99.5%
- [ ] ä¸åŒå‘½ä»¤ç±»å‹å“åº”å»¶è¿Ÿå·®å¼‚<5ms
- [ ] æ— å‘½ä»¤é˜Ÿåˆ—æ··ä¹±

---

### æµ‹è¯•é¡¹ T7.3.6: é”™è¯¯å¸§æ³¨å…¥æµ‹è¯•ï¼ˆP1ï¼‰

#### æµ‹è¯•ç›®çš„
éªŒè¯ç³»ç»Ÿå¯¹é”™è¯¯å¸§çš„å¤„ç†èƒ½åŠ›å’Œé²æ£’æ€§ã€‚

#### é”™è¯¯å¸§ç±»å‹
```
1. CRCé”™è¯¯
2. å¸§é•¿åº¦é”™è¯¯
3. åœ°å€é”™è¯¯
4. å‘½ä»¤ç é”™è¯¯
5. æ•°æ®æº¢å‡º
```

#### æµ‹è¯•æ­¥éª¤

**æ‰‹åŠ¨æ³¨å…¥é”™è¯¯å¸§**:
```python
import serial

ser = serial.Serial('COM3', 115200)

# æ­£ç¡®çš„å¸§: 01 01 FA 06 C8 00 00 32 00 00 0C 80 6B
# é”™è¯¯çš„å¸§ç¤ºä¾‹:
error_frames = [
    bytes([0x01, 0x01, 0xFA, 0x06, 0x00, 0x00]),  # é•¿åº¦é”™è¯¯ï¼ˆè¿‡çŸ­ï¼‰
    bytes([0xFF, 0x01, 0xFA, 0x06, 0xC8, 0x00, 0x00, 0x32, 0x00, 0x00, 0x0C, 0x80, 0x6B]),  # åœ°å€é”™è¯¯
    bytes([0x01, 0x01, 0xFF, 0x06, 0xC8, 0x00, 0x00, 0x32, 0x00, 0x00, 0x0C, 0x80, 0x6B]),  # å‘½ä»¤ç é”™è¯¯
    bytes([0x01, 0x01, 0xFA, 0x06, 0xC8, 0x00, 0x00, 0x32, 0x00, 0x00, 0x0C, 0x80, 0xFF]),  # CRCé”™è¯¯
]

# æ··åˆå‘é€æ­£å¸¸å¸§å’Œé”™è¯¯å¸§
for i in range(100):
    if i % 20 == 0:  # 5%é”™è¯¯ç‡
        ser.write(error_frames[i % len(error_frames)])
    else:
        # å‘é€æ­£å¸¸å‘½ä»¤
        ser.write(b'motor_pos_move(1,0,300,10,1600)\r\n')
    time.sleep(0.1)
```

#### éªŒæ”¶æ ‡å‡†
- [ ] é”™è¯¯å¸§ä¸å¯¼è‡´ç³»ç»Ÿå´©æºƒ
- [ ] é”™è¯¯å¸§è¢«æ­£ç¡®è¯†åˆ«å¹¶ä¸¢å¼ƒ
- [ ] é”™è¯¯æ—¥å¿—æ­£ç¡®è®°å½•
- [ ] é”™è¯¯åæ­£å¸¸å¸§èƒ½ç»§ç»­å¤„ç†

---

## ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»

### ç»¼åˆè¯„åˆ†è¡¨

| æµ‹è¯•é¡¹ | æƒé‡ | ç›®æ ‡å€¼ | å®æµ‹å€¼ | å¾—åˆ† | å¤‡æ³¨ |
|--------|------|--------|--------|------|------|
| T7.3.1é«˜é¢‘æµ‹è¯• | 30% | 99.9% | _____% | ____ | |
| T7.3.2çªå‘æµ‹è¯• | 15% | 99.0% | _____% | ____ | |
| T7.3.3å¤šç”µæœº | 25% | 99.0% | _____% | ____ | |
| T7.3.4æ··åˆå‘½ä»¤ | 20% | 99.5% | _____% | ____ | |
| T7.3.6é”™è¯¯å¸§ | 10% | Pass | _____ | ____ | |
| **æ€»åˆ†** | 100% | **â‰¥95** | **____** | **____** | |

**è¯„åˆ†è§„åˆ™**:
- å®æµ‹å€¼â‰¥ç›®æ ‡å€¼: æ»¡åˆ†
- å®æµ‹å€¼<ç›®æ ‡å€¼: æŒ‰æ¯”ä¾‹æ‰£åˆ†
- æ€»åˆ†â‰¥95åˆ†: é€šè¿‡
- æ€»åˆ†<95åˆ†: éœ€ä¼˜åŒ–åé‡æµ‹

---

## âœ… æµ‹è¯•å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰P0æµ‹è¯•é¡¹å·²å®Œæˆ
- [ ] 80%ä»¥ä¸ŠP1æµ‹è¯•é¡¹å·²å®Œæˆ
- [ ] æµ‹è¯•æ•°æ®å·²è®°å½•å¹¶åˆ†æ
- [ ] æ€§èƒ½ç“¶é¢ˆå·²è¯†åˆ«
- [ ] ä¼˜åŒ–å»ºè®®å·²æ–‡æ¡£åŒ–

---

## ğŸ” æ€§èƒ½ä¼˜åŒ–å»ºè®®

æ ¹æ®æµ‹è¯•ç»“æœï¼Œå¯èƒ½çš„ä¼˜åŒ–æ–¹å‘:

### å¦‚æœé«˜é¢‘æµ‹è¯•ä¸è¾¾æ ‡ï¼ˆ<99.9%ï¼‰
```c
1. å¯ç”¨DMAä¼ è¾“:
   #define RS485_ENABLE_DMA  1

2. å‡å°‘å…³é”®è·¯å¾„å»¶è¿Ÿ:
   - ä¼˜åŒ–FIFOè¯»å†™å‡½æ•°
   - å‡å°‘ä¸­æ–­åµŒå¥—å±‚çº§

3. å¢å¤§FIFOç¼“å†²åŒº:
   #define EMM_FIFO_SIZE  512  // ä»256å¢åŠ åˆ°512
```

### å¦‚æœå¤šç”µæœºæµ‹è¯•ä¸è¾¾æ ‡
```c
1. å¢åŠ æ€»çº¿ç»ˆç«¯ç”µé˜»ï¼ˆ120Î©ï¼‰

2. é™ä½é€šä¿¡æ³¢ç‰¹ç‡ï¼ˆå¯é€‰ï¼‰:
   115200 â†’ 57600

3. å¢åŠ å¸§é—´å»¶è¿Ÿ:
   #define RS485_FRAME_DELAY_MS  5

4. ä½¿ç”¨æ›´é«˜è´¨é‡çš„å±è”½åŒç»çº¿
```

---

**æ–‡æ¡£ç»“æŸ | ä¸‹ä¸€æ­¥: é˜…è¯» `V3.5-Phase7-04-æµ‹è¯•è®°å½•æ¨¡æ¿.md`**
