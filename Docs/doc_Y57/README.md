# 张大头 Y系列 V2.0 步进闭环电机控制系统技术文档

**版本**: V2.0  
**作者**: 张大头智控  
**技术支持**: 淘宝店铺 https://zhangdatou.taobao.com  
**官方文档**: https://www.yuque.com/zhangdatouzhikong/gzng3d

---

## 📚 文档目录

1. [产品概述](01-产品概述.md) - 产品介绍、特点、参数、接口说明
2. [通信协议](02-通信协议.md) - 串口TTL、RS485、CAN通信详解
3. [控制命令详解](03-控制命令详解.md) - 完整的命令列表和参数说明
4. [位置和速度控制](04-位置和速度控制.md) - 位置模式和速度模式详细说明
5. [回零功能](05-回零功能.md) - 四种回零模式及参数配置
6. [多机通讯](06-多机通讯.md) - 多电机总线控制和同步运动
7. [STM32集成指南](07-STM32集成指南.md) - HAL库移植和示例代码
8. [故障排查](08-故障排查.md) - 常见问题和解决方案

---

## 🚀 快速开始

### 硬件连接（RS485模式）

```
STM32开发板          RS485模块        Y系列电机
    PA2(TX)  -----→  TX
    PA3(RX)  -----→  RX               
    5V       -----→  VCC
    GND      -----→  GND        
                     A     -----→    A
                     B     -----→    B
```

### 基本初始化代码

```c
// 初始化RS485通信（波特率115200）
atk_rs485_init(115200);

// 等待电机上电初始化完成
delay_ms(2000);

// 使能电机
Emm_V5_En_Control(1, true, false);

// 位置控制示例：转动一圈
// 参数：地址1, 顺时针, 1000RPM, 加速度0, 3200脉冲(1圈), 相对运动, 不同步
Emm_V5_Pos_Control(1, 0, 1000, 0, 3200, false, false);
```

---

## 📋 核心特性

- ✅ **多种控制模式**: 位置模式、速度模式、脉冲模式
- ✅ **高精度闭环**: 16细分，3200脉冲/圈
- ✅ **多种通信接口**: TTL串口、RS485、CAN总线
- ✅ **多机同步**: 支持最多255个电机总线控制
- ✅ **智能回零**: 4种回零模式（单圈、多圈、有/无限位）
- ✅ **堵转保护**: 电流检测和超时保护
- ✅ **掉电记忆**: 参数断电保存

---

## 🔧 技术参数概览

| 参数项 | 规格 |
|--------|------|
| **通信波特率** | 9600 ~ 115200 bps（推荐115200） |
| **工作电压** | 12V ~ 48V DC |
| **速度范围** | 0 ~ 5000 RPM |
| **加速度** | 0 ~ 255（0为直接启动） |
| **细分精度** | 16细分（3200脉冲/圈） |
| **脉冲范围** | 0 ~ 4,294,967,295 |
| **电机地址** | 1 ~ 255 |
| **校验字节** | 固定 0x6B |

---

## 📡 命令帧格式

所有命令均采用以下通用格式：

```
[地址] [功能码] [辅助码/参数...] [校验字节0x6B]
```

**示例 - 使能电机**:
```
0x01 0xF3 0xAB 0x01 0x00 0x6B
 │    │    │    │    │    └─ 校验字节（固定）
 │    │    │    │    └────── 同步标志（0=立即执行）
 │    │    │    └─────────── 使能状态（1=使能）
 │    │    └──────────────── 辅助码
 │    └───────────────────── 功能码（使能控制）
 └────────────────────────── 电机地址（1号电机）
```

---

## 🛠 开发环境要求

- STM32 HAL库 或 标准库
- Keil MDK-ARM / STM32CubeIDE
- RS485通信模块（如正点原子ATK-MB024）
- 串口调试工具

---

## 📞 技术支持

- **淘宝店铺**: https://zhangdatou.taobao.com
- **CSDN博客**: https://blog.csdn.net/zhangdatou666
- **QQ交流群**: 262438510
- **在线文档**: https://www.yuque.com/zhangdatouzhikong/gzng3d

---

## ⚠️ 重要提示

1. **上电延时**: 发送命令前必须延时2秒等待电机初始化
2. **波特率设置**: 推荐使用115200，与电机参数配置一致
3. **细分设置**: 默认16细分，3200脉冲对应电机转动一圈
4. **多机地址**: RS485总线上每个电机必须设置唯一地址
5. **同步运动**: 使用同步标志时需调用 `Emm_V5_Synchronous_motion(0)` 触发

---

**文档更新日期**: 2025-11-30  
**适用固件版本**: Emm_V5.0 及更高版本
